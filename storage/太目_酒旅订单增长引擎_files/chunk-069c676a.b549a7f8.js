(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-069c676a"],{"118c":function(t,e,n){},1766:function(t,e,n){"use strict";n.r(e);n("ac1f"),n("00b4"),n("4d63"),n("c607"),n("2c3e"),n("25f0"),n("5319"),n("a9e3"),n("14d9"),n("caad"),n("2532"),n("d81d"),n("a15b"),n("a434"),n("466d");var i=n("9895"),o=n("4ec3"),r=n("a77c"),a={data:function(){return{loading:!1,timeBox:!1,compensationArr:[{value:"时间段"},{value:"单天"}],compensationData:"时间段",canNotUse:{usableStart:"",usableEnd:"",oneDate:""},minStayValue:6,canNotUseEnd:!0,guildList:[{name:"产品",pagePath:""},{name:"新建预约产品",pagePath:"/main/productManage/bookCommoditySalesInfo"}],vacations:{weekend:{name:"周末",isSelect:!1},SUN:{name:"周日",isSelect:!1},MON:{name:"周一",isSelect:!1},TUE:{name:"周二",isSelect:!1},WED:{name:"周三",isSelect:!1},THUR:{name:"周四",isSelect:!1},FRI:{name:"周五",isSelect:!1},SAT:{name:"周六",isSelect:!1},holiday_NewYear:{name:"元旦",isSelect:!1},holiday_SpringFestival:{name:"春节",isSelect:!1},holiday_LabourDay:{name:"劳动节",isSelect:!1},holiday_Qing_Ming:{name:"清明",isSelect:!1},holiday_Duan_Wu:{name:"端午",isSelect:!1},holiday_Mid_Autumn_Festival:{name:"中秋",isSelect:!1},holiday_NationalDay:{name:"国庆",isSelect:!1},ChineseValentine:{name:"七夕",isSelect:!1},Valentinesday:{name:"情人节(2-14)",isSelect:!1},Christmas:{name:"圣诞节(12-24,12-25)",isSelect:!1}},stockArr:[{value:"有限库存",key:0},{value:"无限库存",key:-1}],bookNightArr:[{value:"2晚",key:2},{value:"3晚",key:3},{value:"4晚",key:4},{value:"5晚",key:5}],stayTypeArr:[{value:"1",label:"按晚数"},{value:"2",label:"按间数"},{value:"3",label:"按间夜"}],minStay:2,stayType:"1",customMinStay:"",tolAmount:"",intended:"0",competenceLimits:[{value:"不限"},{value:"上限"}],isTransfer:!1,backChange:[{key:"2",value:"未预约可退"},{key:"0",value:"不可取消"}],cancelCondition:"",bookingCancelDesc:"",customBookingCancelDesc:"",isSubProduct:!!this.$route.query.isSubProduct,isMoreShop:!0,otaAllowed:!0,isContinuousList:[{key:"2",value:"1晚"},{key:"0",value:"多晚且需连续入住"},{key:"1",value:"多晚且可拆分入住"}],continuousValue:"2",ppStock:"",pp:!1,couponStock:"",isEdit:!1,allowTikTok:!0,buyModeList:[{value:"0",key:"混合销售"},{value:"1",key:"预售"},{value:"2",key:"直接预订"}],purchaseMode:"0",buyModeVisiable:!1,orderRemark:"",isPieces:!1,pieces:"",cancelDesc:"",breakfastDesc:"",breakfast:"",customBreakfast:"",breakfastMap:[{value:"无早",label:"无早"},{value:"单早",label:"单早"},{value:"双早",label:"双早"},{value:"三早",label:"三早"},{value:"自定义",label:"自定义"}],breakfastDescIsFocus:!1,maxStays:!0}},methods:{inputBlur:function(){window.document.querySelector(".el-input-group__prepend").style.borderColor="var(--border-color-base)",this.breakfastDescIsFocus=!1},inputFocus:function(t){var e=window.document.querySelector(".el-input-group__prepend");e.style.borderColor=1===t?"var(--color-primary)":"var(--border-color-base)",this.breakfastDescIsFocus=!0},getContent:function(t){this.cancelDesc=t},piecesInput:function(t){this.isPieces=!!t},handleppChange:function(t){t&&!this.isEdit&&"1"===this.continuousValue&&(this.continuousValue="0",this.minStay=2)},handleSupportChange:function(t){this.maxStays=t},timeDetail:i.o,handleContinuousValue:function(t){this.isPieces=!1,this.minStay="0"===t||"1"===t?2:1},handleBuyModeValue:function(t){this.purchaseMode=t,"2"===t?(this.backChange=[{key:"0",value:"不可取消"},{key:"2",value:"自定义"}],this.cancelCondition="0"):(this.backChange=[{key:"2",value:"未预约可退"},{key:"0",value:"不可取消"}],this.cancelCondition="2")},handleCancelConditionChange:function(t){this.bookingCancelDesc="",this.customBookingCancelDesc=""},checkNumber:function(t){new RegExp("^[0-9]*$").test(t.target.value)||(this.$message.warning("请输入大于0的正数"),t.target.value="")},open3:function(t){this.$message({message:t,type:"warning"})},open2:function(t){this.$message({message:t,type:"success"})},number:function(){this.couponStock=this.couponStock.replace(/^((\d*[1-9])|(0?\.\d{2}))$/g,"")},initParams:function(){var t={},e=(this.productId,this.couponStock),n=this.minStay,i=this.minStayValue,o=(this.excludeDateList,this.vacations,this.continuousValue),r=this.stayType;return t.cancelCondition=this.cancelCondition,"2"===this.purchaseMode?("2"===this.cancelCondition?t.bookingCancelDesc=this.customBookingCancelDesc:t.bookingCancelDesc="",t.cancelCondition="0"):"2"===this.cancelCondition?"自定义"===this.bookingCancelDesc?t.bookingCancelDesc=this.customBookingCancelDesc:t.bookingCancelDesc=this.bookingCancelDesc:t.bookingCancelDesc="",1===n?(t.nights=1,t.minStay=1):n>1&&("1"===o?(t.minStay=1,t.nights=6===n?i:n):(t.minStay=6===n?this.customMinStay:n,t.nights=6===n?this.customMinStay:n,t.stayType=r)),t.couponStock=e,t},save:function(){var t=this,e=this.$route.query.productId,n=this.initParams();if(""!=n.couponStock)if(n.couponStock<=0)this.open3("产品库存为大于0的正整数");else if(this.pp&&(!this.ppStock||this.ppStock<=0))this.open3("请输入0元囤库存！");else if("0"===this.continuousValue&&Number(n.minStay)>30)this.$message.warning("多晚连住最多支持30晚，请修改");else if("0"!==this.continuousValue||1!==Number(n.minStay)){if("2"!==this.purchaseMode){if("2"===this.cancelCondition&&!this.bookingCancelDesc)return this.$message.warning("请选择退改政策");if("2"===this.cancelCondition&&"自定义"===this.bookingCancelDesc&&!this.customBookingCancelDesc)return this.$message.warning("请输入退改政策")}else if("2"===this.cancelCondition&&!this.customBookingCancelDesc)return this.$message.warning("请输入退改政策");if(n.pp=this.pp,n.maxStays=this.maxStays?10:1,this.pp&&(n.ppSku={stock:this.ppStock}),n.couponSku={stock:Number(this.couponStock)},"自定义"!==this.breakfast||""!==this.customBreakfast)if(""!==this.breakfast){if("自定义"!==this.breakfast?n.breakfast=this.breakfast:n.breakfast=this.customBreakfast+"早",n.breakfastDesc=this.breakfastDesc,this.isPieces){if(""===this.pieces||this.pieces<2)return void this.$message.warning("按组购买每组最少是2份，请修改");n.pieces=this.pieces}else n.pieces="1";n.purchaseMode=this.purchaseMode,this.otaAllowed&&this.allowTikTok?n.otaAllowed="11":this.otaAllowed?n.otaAllowed="1":this.allowTikTok?n.otaAllowed="10":n.otaAllowed="0",""!==this.orderRemark&&(n.orderRemark=this.orderRemark),n.cancelDesc=this.cancelDesc,this.loading=!0,Object(o.bd)(e,n).then((function(e){if(t.loading=!1,0==e.data.sc){console.log("success"),t.loading=!1;var n=t.$route.query.roleType||"",i="/main/productManage/bookCommodityInformation?productId="+t.$route.query.productId+"&menuName="+t.$route.query.menuName+"&roleType="+n;t.isSubProduct&&(i+="&isSubProduct="+!0),t.$router.push({path:i})}else t.loading=!1,t.$message.error(e.data.ErrorMsg||e.data.errorMsg||"系统卖力生长中")})).catch((function(e){console.log(e),t.loading=!1,t.$message.error("系统卖力生长中，请稍后再试")}))}else this.$message.warning("请选择早餐政策");else this.$message.warning("请输入自定义早餐政策")}else this.$message.warning("多晚连住最少2晚起，请修改");else this.open3("请输入产品库存")},getBookingproductBasicinfoFunction:function(){var t=this,e=this.$route.query.productId;this.loading=!0,Object(o.Pe)(e).then((function(e){t.loading=!1;var n=e.data,i=n.data,o=n.sc,r=n.errorMsg;if("0"!==o)return t.$message.error(r||"系统卖力生长中，请稍后再试！");t.otaAllowed="1"===i.otaAllowed||"11"===i.otaAllowed,t.allowTikTok="10"===i.otaAllowed||"11"===i.otaAllowed,1==i.nights&&"1"===i.minStay?(t.minStay=1,t.continuousValue="2"):1==i.nights?(t.minStay=Number(i.minStay),t.continuousValue="0"):i.nights>1&&(1==i.minStay?(t.minStay=Number(i.nights)>5?6:Number(i.nights),t.minStay>5&&(t.minStayValue=Number(i.nights)),t.continuousValue="1"):(t.minStay=Number(i.nights),t.continuousValue="0",t.minStay>5&&(t.minStay=6,t.customMinStay=Number(i.nights)),t.stayType=i.stayType)),i.cancelCondition&&(t.cancelCondition=i.cancelCondition),i.bookingCancelDesc&&("2"===i.purchaseMode?"不支持退改"!==i.bookingCancelDesc&&(t.cancelCondition="2",t.customBookingCancelDesc=i.bookingCancelDesc):"不支持退改"!==i.bookingCancelDesc?(t.bookingCancelDesc="自定义",t.customBookingCancelDesc=i.bookingCancelDesc):t.bookingCancelDesc=i.bookingCancelDesc),i.couponSku&&(0==i.couponSku.stock?t.couponStock="":t.couponStock=i.couponSku.stock),t.pp=i.pp||!1,t.maxStays=1!=i.maxStays,t.ppStock=i.ppSku&&i.ppSku.stock||"",t.purchaseMode=i.purchaseMode,t.pieces=Number(i.pieces)>1?i.pieces:"",Number(i.pieces)>1&&(t.isPieces=!0),"2"===i.purchaseMode&&(t.backChange=[{key:"0",value:"不可取消"},{key:"2",value:"自定义"}]),t.orderRemark=i.orderRemark||"",t.cancelDesc=i.cancelDesc||"",t.breakfastMap.map((function(t){return t.value})).includes(i.breakfast)||""===i.breakfast?t.breakfast=i.breakfast:(t.breakfast="自定义",t.customBreakfast=i.breakfast.split("").splice(0,i.breakfast.length-1).join("")),t.breakfastDesc=i.breakfastDesc||"",t.isEdit="10"!==i.status}))},backPage:function(){this.$router.push({path:"/main/productManage/newCommodity?productId="+this.$route.query.productId})},getCookie:function(t){var e,n=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return!!(e=document.cookie.match(n))&&e[2]}},mounted:function(){this.$route.query.productId&&this.getBookingproductBasicinfoFunction()},watch:{continuousValue:function(t){"1"===t?(this.buyModeList=[{value:"1",key:"预售"}],this.purchaseMode="1",this.buyModeVisiable=!0):(this.buyModeList=[{value:"0",key:"混合销售"},{value:"1",key:"预售"},{value:"2",key:"直接预订"}],this.buyModeVisiable=!1)},isPieces:function(t){t?(this.purchaseMode="1",this.buyModeVisiable=!0):(this.pieces="",this.purchaseMode="0",this.buyModeVisiable=!1)}},components:{editor3:r.a}},s=(n("c2ba"),n("e0cb"),n("2877")),l=Object(s.a)(a,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{id:"bookCommoditySalesInfo","element-loading-text":"拼命加载中","element-loading-background":"rgba(0, 0, 0, 0.8)"},on:{click:t.inputBlur}},[e("tm-crumb",{attrs:{guildList:t.guildList}},[e("tm-steps",{attrs:{steps:["基本信息","售卖规则","预订规则","购买规则"],active:2}})],1),e("div",{staticClass:"contentBox wrapper_box_radius background_white wrapper_box_border"},[e("div",{staticClass:"contentBookCompetence"},[e("div",{staticClass:"wrpTitle"},[t._v("售卖规则")]),e("div",{staticClass:"competenceItem",staticStyle:{"align-items":"baseline"}},[e("div",{staticClass:"itemTitle"},[t._v(" 产品库存： ")]),e("div",{staticClass:"itemInner",staticStyle:{display:"flex","align-items":"center"}},[e("div",{staticClass:"itemInnerBox",staticStyle:{display:"flex","align-items":"center"}},[e("div",{staticStyle:{"font-size":"12px",color:"var(--color-text-primary)","margin-right":"4px"}},[t._v("套餐价库存：")]),e("el-input",{staticStyle:{width:"110px"},attrs:{disabled:t.isSubProduct,type:"text",placeholder:"请输入库存"},nativeOn:{keyup:function(e){return t.checkNumber(e)}},model:{value:t.couponStock,callback:function(e){t.couponStock=e},expression:"couponStock"}}),e("div",{staticClass:"margin-left font-size-12"},[t._v("份")])],1),e("div",{staticClass:"lineBox",staticStyle:{width:"1px",height:"12px",background:"var(--border-color-base)","margin-left":"10px","margin-right":"10px"}}),e("div",{staticClass:"itemInnerBox",staticStyle:{display:"flex","align-items":"center"}},[e("el-checkbox",{attrs:{disabled:t.isSubProduct||t.isEdit&&"1"===t.continuousValue},on:{change:t.handleppChange},model:{value:t.pp,callback:function(e){t.pp=e},expression:"pp"}},[t._v("支持0元无忧囤")]),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top"}},[e("div",{staticClass:"tooltipBox",staticStyle:{"margin-right":"10px","margin-left":"4px"}}),e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 售卖方开通0元无忧囤功能后，用户可直接"),e("br"),t._v(" 不花钱囤券，核销时进行券+补差付款 ")])]),t.pp?e("span",{staticStyle:{"font-size":"12px",color:"var(--color-text-primary)","line-height":"18px"}},[t._v("0元无忧囤库存：")]):t._e(),t.pp?e("el-input",{staticStyle:{width:"100px"},attrs:{disabled:t.isSubProduct,type:"text",placeholder:"请输入数量"},nativeOn:{keyup:function(e){return t.checkNumber(e)}},model:{value:t.ppStock,callback:function(e){t.ppStock=e},expression:"ppStock"}}):t._e(),t.pp?e("span",{staticClass:"font-size-12 margin-left"},[t._v("份")]):t._e()],1)])]),e("div",{staticClass:"competenceItem",staticStyle:{"align-items":"baseline"}},[e("div",{staticClass:"itemTitle"},[t._v(" 每份晚数： ")]),e("div",[e("div",{staticClass:"itemInner"},[e("div",{staticClass:"comoetenceBox flex-align-center"},[e("div",{staticClass:"isContinuous"},[e("el-select",{staticClass:"leixing",staticStyle:{width:"142px"},attrs:{disabled:t.isSubProduct||t.isEdit,placeholder:"全部"},on:{change:t.handleContinuousValue},model:{value:t.continuousValue,callback:function(e){t.continuousValue=e},expression:"continuousValue"}},t._l(t.isContinuousList,(function(n){return e("el-option",{key:n.key,staticClass:"leixing1",attrs:{disabled:"1"===n.key&&t.pp,label:n.value,value:n.key}})})),1)],1),1===t.minStay?e("div",{staticClass:"itemInnerBox margin-left",staticStyle:{display:"flex","align-items":"center"}},[e("el-checkbox",{on:{change:t.handleSupportChange},model:{value:t.maxStays,callback:function(e){t.maxStays=e},expression:"maxStays"}},[t._v("支持多晚下单")]),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top"}},[e("div",{staticClass:"tooltipBox",staticStyle:{"margin-right":"10px","margin-left":"4px"}}),e("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 直接预订/囤券单预订时，支持选择连"),e("br"),t._v(" 续多晚，下单多份商品 ")])])],1):t._e(),e("el-select",{directives:[{name:"show",rawName:"v-show",value:"2"!==t.continuousValue,expression:"continuousValue !== '2'"}],staticClass:"leixing margin-left",staticStyle:{width:"82px"},attrs:{disabled:t.isSubProduct||t.isEdit,placeholder:"全部",size:"small"},model:{value:t.minStay,callback:function(e){t.minStay=e},expression:"minStay"}},[t._l(t.bookNightArr,(function(t){return e("el-option",{key:t.key,staticClass:"leixing1",attrs:{label:t.value,value:t.key}})})),"2"!==t.continuousValue?e("el-option",{staticClass:"leixing1",attrs:{label:"自定义",value:6}}):t._e()],2),6===t.minStay&&"0"===t.continuousValue?e("div",{staticClass:"margin-left custonMinStayBox flex flex-align-center"},[e("el-input",{staticStyle:{width:"60px"},attrs:{disabled:t.isSubProduct||t.isEdit,placeholder:"需≤30",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:t.customMinStay,callback:function(e){t.customMinStay=e},expression:"customMinStay"}}),e("div",{staticClass:"margin-left font-12 color-text-primary"},[t._v("晚")])],1):t._e(),e("el-select",{directives:[{name:"show",rawName:"v-show",value:0==t.continuousValue,expression:"continuousValue == 0"}],staticClass:"leixing margin-left",staticStyle:{width:"82px"},attrs:{disabled:t.isSubProduct||t.isEdit,placeholder:"请选择",size:"small"},model:{value:t.stayType,callback:function(e){t.stayType=e},expression:"stayType"}},t._l(t.stayTypeArr,(function(t){return e("el-option",{key:t.value,staticClass:"leixing1",attrs:{label:t.label,value:t.value}})})),1),6===t.minStay&&"1"===t.continuousValue?e("el-input-number",{staticClass:"margin-left",staticStyle:{width:"60px"},attrs:{max:30,disabled:t.isSubProduct||t.isEdit,step:1,controls:!1,"step-strictly":!0,"controls-position":"right",min:6},model:{value:t.minStayValue,callback:function(e){t.minStayValue=e},expression:"minStayValue"}}):t._e(),6===t.minStay&&"1"===t.continuousValue?e("div",{staticClass:"margin-left font-12 color-text-primary"},[t._v("晚")]):t._e(),t.minStay>1&&t.pp?e("div",{staticClass:"margin-left",staticStyle:{color:"var(--color-text-grey-1)","font-size":"12px","line-height":"32px"}},[t._v(" (“支持0元无忧囤”套餐，暂无法配置多晚拆分入住) ")]):t._e()],1)]),t.minStay>1&&1==t.continuousValue?e("div",{staticClass:"margin-left comoTip"},[t._v(" (支持多晚拆分使用，用户需先囤券后预订，不支持直接预订、0元囤，套餐基础价为多晚总价，补差为单晚补差) ")]):t._e(),0==t.continuousValue?e("div",{staticClass:"margin-left comoTip"},[t._v(" (多晚连住支持:仅允许按晚连住、仅允许按间连住、 可按晚连住或按间连住) ")]):t._e()])]),e("div",{staticClass:"competenceItem",staticStyle:{"align-items":"flex-start"}},[e("div",{staticClass:"itemTitle",staticStyle:{"line-height":"32px"}},[t._v(" 早餐政策： ")]),e("div",{staticClass:"itemInner flex-1"},[e("div",{staticClass:"flex flex-direction-column flex-1"},[e("div",{staticClass:"flex flex-align-center"},[e("el-select",{staticStyle:{width:"82px"},model:{value:t.breakfast,callback:function(e){t.breakfast=e},expression:"breakfast"}},t._l(t.breakfastMap,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),"自定义"===t.breakfast?e("el-input",{staticClass:"margin-left",staticStyle:{width:"60px"},model:{value:t.customBreakfast,callback:function(e){t.customBreakfast=e},expression:"customBreakfast"}}):t._e(),"自定义"===t.breakfast?e("span",{staticClass:"margin-left font-size-12"},[t._v("早")]):t._e(),e("span",{staticClass:"margin-left color-acb1b8 font-size-12"},[t._v("(每晚)")])],1),e("div",{staticClass:"margin-top customInput"},[e("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"选填，输入更多的早餐描述"},nativeOn:{click:function(e){return e.stopPropagation(),t.inputFocus(1)}},model:{value:t.breakfastDesc,callback:function(e){t.breakfastDesc=e},expression:"breakfastDesc"}},[e("template",{slot:"prepend"},[t._v("早餐描述：")])],2),e("div",{directives:[{name:"show",rawName:"v-show",value:t.breakfastDescIsFocus,expression:"breakfastDescIsFocus"}],staticClass:"color-acb1b8 font-size-12 margin-top",on:{click:function(e){return e.stopPropagation(),t.inputFocus(2)}}},[t._v(" 示例：儿童早餐收费：1.2m以下免费，1.2-1.5m收费68元/位，1.5m以上收费128元/位 ")])],1)])])]),"2"===t.continuousValue?e("div",{staticClass:"competenceItem",staticStyle:{"align-items":"flex-start"}},[e("div",{staticClass:"itemTitle",staticStyle:{"line-height":"32px"}},[t._v(" 是否按组购买： ")]),e("div",{staticClass:"itemInner"},[e("div",{staticClass:"flex flex-direction-column font-size-12"},[e("div",{staticClass:"flex flex-align-center"},[e("el-checkbox",{model:{value:t.isPieces,callback:function(e){t.isPieces=e},expression:"isPieces"}}),e("span",{staticClass:"margin-right margin-left"},[t._v("按组购买，每组")]),e("el-input",{staticStyle:{width:"60px"},attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')",placeholder:"需≥2"},on:{input:t.piecesInput},model:{value:t.pieces,callback:function(e){t.pieces=e},expression:"pieces"}}),e("span",{staticClass:"margin-left"},[t._v("份")]),e("span",{staticClass:"margin-left color-acb1b8"},[t._v("(共计"+t._s(t.pieces||"-")+"晚，可拆住)")]),e("el-popover",{attrs:{placement:"right",width:"394",trigger:"hover"}},[e("img",{staticStyle:{width:"394px",height:"406px","vertical-align":"top"},attrs:{src:"https://htmlqiniu.jihex.com/saas/saas-ui/202306121152883.png",alt:""}}),e("tm-button",{attrs:{slot:"reference",type:"text",left:10},slot:"reference"},[t._v("查看示例")])],1)],1),e("div",{staticClass:"color-acb1b8 margin-top"},[t._v("(用户需按组购买，同时可购买多组。根据退改规则及合作规则按份结算)")])])])]):t._e(),e("div",{staticClass:"competenceItem",staticStyle:{"align-items":"baseline"}},[e("div",{staticClass:"itemTitle"},[t._v(" 销售模式： ")]),e("div",[e("div",{staticClass:"itemInner"},[e("div",{staticClass:"comoetenceBox flex-align-center"},[e("div",{staticClass:"isContinuous"},[e("el-select",{staticClass:"leixing",staticStyle:{width:"126px"},attrs:{placeholder:"全部",disabled:t.buyModeVisiable},on:{change:t.handleBuyModeValue},model:{value:t.purchaseMode,callback:function(e){t.purchaseMode=e},expression:"purchaseMode"}},t._l(t.buyModeList,(function(t){return e("el-option",{key:t.key,staticClass:"leixing1",attrs:{label:t.key,value:t.value}})})),1)],1)])]),"0"===t.purchaseMode?e("div",{staticClass:"comoTip"},[e("span",[t._v(" (产品销售期间，预售+直接预订同时开放。客人可支持先囤卷，囤卷后进行预订操作，或直接进行预订。预订单支付成功后 → 需供应商（您）接单确认 → 客人可入住/出行， ")]),e("span",[e("el-popover",{attrs:{placement:"right","popper-class":"buyModePopover",trigger:"hover"}},[e("img",{staticStyle:{width:"196px",height:"406px"},attrs:{src:"https://htmlqiniu.jihex.com/saas%2Fsaas-ui%2Feg_product8_pic.png",alt:""}}),e("tm-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[t._v("查看示例")])],1),t._v(" ) ")],1)]):t._e(),"1"===t.purchaseMode?e("div",{staticClass:"comoTip"},[e("span",[t._v(" (产品销售期间，客人购买成功后 → 系统自动发送预售券 → 客人需使用预售券进行在线预订操作 → 预订单支付成功后 → 需供应商（您）接单确认 → 客人可入住/出行， ")]),e("span",[e("el-popover",{attrs:{placement:"right","popper-class":"buyModePopover",trigger:"hover"}},[e("img",{staticStyle:{width:"196px",height:"406px"},attrs:{src:"https://htmlqiniu.jihex.com/saas%2Fsaas-ui%2Feg_product9_pic.png",alt:""}}),e("tm-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[t._v("查看示例")])],1),t._v(" ) ")],1)]):t._e(),"2"===t.purchaseMode?e("div",{staticClass:"comoTip"},[e("span",[t._v(" (产品销售期间，客人需选择入住/出行日进行预订 → 预订单支付成功后 → 需供应商（您）接单确认 → 客人可入住/出行， ")]),e("span",[e("el-popover",{attrs:{placement:"right","popper-class":"buyModePopover",trigger:"hover"}},[e("img",{staticStyle:{width:"196px",height:"406px"},attrs:{src:"https://htmlqiniu.jihex.com/saas/saas-ui/202303011605608.png",alt:""}}),e("tm-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[t._v("查看示例")])],1)],1),t._m(0)]):t._e()])]),e("div",{staticClass:"competenceItem",staticStyle:{"align-items":"flex-start"}},[e("div",{staticClass:"itemTitle",staticStyle:{"line-height":"32px"}},[t._v(" 退改政策： ")]),e("div",{staticStyle:{flex:"1"}},[e("div",{staticClass:"itemInner"},[e("el-select",{staticStyle:{width:"106px"},attrs:{disabled:t.isSubProduct},on:{change:t.handleCancelConditionChange},model:{value:t.cancelCondition,callback:function(e){t.cancelCondition=e},expression:"cancelCondition"}},t._l(t.backChange,(function(t){return e("el-option",{key:t.key,attrs:{placeholder:"请选择",label:t.value,value:t.key}})})),1),"2"===t.cancelCondition&&"2"!==t.purchaseMode?[e("span",{staticClass:"font-size-12 margin-left color-text-regular"},[t._v("，预约后")]),e("el-select",{staticClass:"margin-left",staticStyle:{width:"106px"},attrs:{disabled:t.isSubProduct},model:{value:t.bookingCancelDesc,callback:function(e){t.bookingCancelDesc=e},expression:"bookingCancelDesc"}},[e("el-option",{attrs:{label:"不支持退改",value:"不支持退改"}}),e("el-option",{attrs:{label:"自定义",value:"自定义"}})],1),"自定义"===t.bookingCancelDesc?e("el-input",{staticClass:"margin-left",staticStyle:{width:"180px"},attrs:{placeholder:"",maxlength:"8","show-word-limit":""},model:{value:t.customBookingCancelDesc,callback:function(e){t.customBookingCancelDesc=e},expression:"customBookingCancelDesc"}}):t._e()]:t._e(),"2"===t.cancelCondition&&"2"===t.purchaseMode?[e("el-input",{staticClass:"margin-left",staticStyle:{width:"180px"},attrs:{placeholder:""},model:{value:t.customBookingCancelDesc,callback:function(e){t.customBookingCancelDesc=e},expression:"customBookingCancelDesc"}})]:t._e()],2),"2"===t.cancelCondition&&"2"===t.purchaseMode?e("div",{staticClass:"font-size-12 color-acb1b8 margin-top"},[t._v(" （自定义选项仅针对用户端文案展示，系统不支持已预约的订单由用户发起自动退款，需要联系店铺客服进行操作，请务必在备注或详情页中注明退改条件和操作方式） ")]):t._e(),"自定义"===t.bookingCancelDesc&&"2"!==t.purchaseMode?e("div",{staticClass:"font-size-12 color-acb1b8 margin-top"},[t._v(" 示例：输入「按条件退改」，用户端显示「未预约可退，预约后按条件退改」"),e("br"),t._v(" （自定义选项仅针对用户端文案展示，系统不支持已预约的订单由用户发起自动退款，需要联系店铺客服进行操作，请务必在备注或详情页中注明退改条件和操作方式） ")]):t._e(),e("div",{staticClass:"margin-top-16"},[e("editor3",{attrs:{id:"commidySaleInfoEditer",fromContent:t.cancelDesc},on:{getContent:t.getContent}})],1)])])])]),e("div",{staticClass:"contentBox wrapper_box_radius background_white wrapper_box_border margin-top"},[e("div",{staticClass:"contentBookCompetence"},[e("div",{staticClass:"wrpTitle"},[t._v("其他规则")]),e("div",{staticClass:"competenceItem",staticStyle:{"align-items":"flex-start"}},[e("div",{staticClass:"itemTitle"},[t._v(" 外部销售： ")]),e("div",{staticClass:"itemInner"},[e("div",[e("div",{staticClass:"itemInnerCheckBox"},[e("el-checkbox",{attrs:{disabled:t.isSubProduct},model:{value:t.otaAllowed,callback:function(e){t.otaAllowed=e},expression:"otaAllowed"}},[t._v("允许分销商同步OTA销售（如飞猪、携程等） ")])],1),e("div",{staticClass:"itemInnerCheckBox flex flex-align-center"},[e("el-checkbox",{attrs:{disabled:t.isSubProduct},model:{value:t.allowTikTok,callback:function(e){t.allowTikTok=e},expression:"allowTikTok"}},[t._v("允许分销商同步至抖音POI页面销售 ")]),e("span",{staticClass:"note"},[t._v("(相同商品抖音POI页面只允许展示一个，勾选后展示位属于第一个推送的商户)")])],1)])])]),e("div",{staticClass:"competenceItem",staticStyle:{"align-items":"baseline"}},[e("div",{staticClass:"itemTitle"},[t._v(" 接单备注 (选填)： ")]),e("div",{staticClass:"itemInner"},[e("el-input",{staticStyle:{width:"732px"},attrs:{placeholder:"如您已直连PMS，该字段将自动同步PMS",maxlength:"30","show-word-limit":""},model:{value:t.orderRemark,callback:function(e){t.orderRemark=e},expression:"orderRemark"}})],1)])])]),e("div",{staticClass:"footerBtn wrapper_box_radius background_white wrapper_box_border"},[e("tm-button",{attrs:{type:"primary-d"},on:{click:t.save}},[t._v("保存并下一步")])],1)],1)}),[function(){var t=this._self._c;return t("span",[this._v("。因推送抖音POI产品售价需与详情保持一致，"),t("span",{staticStyle:{color:"var(--color-danger)"}},[this._v("仅直接预订产品不支持同步抖音销售")]),this._v(")")])}],!1,null,"cd330dba",null);e.default=l.exports},"23c1":function(t,e,n){"use strict";n("a474")},2811:function(t,e,n){"use strict";n("118c")},68636:function(t,e,n){},"69a0":function(t,e,n){t.exports=function(t){"use strict";var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(t,e){var n=t[0],i=t[1],o=t[2],r=t[3];i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+e[0]-680876936|0)<<7|n>>>25)+i|0)&i|~n&o)+e[1]-389564586|0)<<12|r>>>20)+n|0)&n|~r&i)+e[2]+606105819|0)<<17|o>>>15)+r|0)&r|~o&n)+e[3]-1044525330|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+e[4]-176418897|0)<<7|n>>>25)+i|0)&i|~n&o)+e[5]+1200080426|0)<<12|r>>>20)+n|0)&n|~r&i)+e[6]-1473231341|0)<<17|o>>>15)+r|0)&r|~o&n)+e[7]-45705983|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+e[8]+1770035416|0)<<7|n>>>25)+i|0)&i|~n&o)+e[9]-1958414417|0)<<12|r>>>20)+n|0)&n|~r&i)+e[10]-42063|0)<<17|o>>>15)+r|0)&r|~o&n)+e[11]-1990404162|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+e[12]+1804603682|0)<<7|n>>>25)+i|0)&i|~n&o)+e[13]-40341101|0)<<12|r>>>20)+n|0)&n|~r&i)+e[14]-1502002290|0)<<17|o>>>15)+r|0)&r|~o&n)+e[15]+1236535329|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+e[1]-165796510|0)<<5|n>>>27)+i|0)&o|i&~o)+e[6]-1069501632|0)<<9|r>>>23)+n|0)&i|n&~i)+e[11]+643717713|0)<<14|o>>>18)+r|0)&n|r&~n)+e[0]-373897302|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+e[5]-701558691|0)<<5|n>>>27)+i|0)&o|i&~o)+e[10]+38016083|0)<<9|r>>>23)+n|0)&i|n&~i)+e[15]-660478335|0)<<14|o>>>18)+r|0)&n|r&~n)+e[4]-405537848|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+e[9]+568446438|0)<<5|n>>>27)+i|0)&o|i&~o)+e[14]-1019803690|0)<<9|r>>>23)+n|0)&i|n&~i)+e[3]-187363961|0)<<14|o>>>18)+r|0)&n|r&~n)+e[8]+1163531501|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+e[13]-1444681467|0)<<5|n>>>27)+i|0)&o|i&~o)+e[2]-51403784|0)<<9|r>>>23)+n|0)&i|n&~i)+e[7]+1735328473|0)<<14|o>>>18)+r|0)&n|r&~n)+e[12]-1926607734|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+e[5]-378558|0)<<4|n>>>28)+i|0)^i^o)+e[8]-2022574463|0)<<11|r>>>21)+n|0)^n^i)+e[11]+1839030562|0)<<16|o>>>16)+r|0)^r^n)+e[14]-35309556|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+e[1]-1530992060|0)<<4|n>>>28)+i|0)^i^o)+e[4]+1272893353|0)<<11|r>>>21)+n|0)^n^i)+e[7]-155497632|0)<<16|o>>>16)+r|0)^r^n)+e[10]-1094730640|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+e[13]+681279174|0)<<4|n>>>28)+i|0)^i^o)+e[0]-358537222|0)<<11|r>>>21)+n|0)^n^i)+e[3]-722521979|0)<<16|o>>>16)+r|0)^r^n)+e[6]+76029189|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+e[9]-640364487|0)<<4|n>>>28)+i|0)^i^o)+e[12]-421815835|0)<<11|r>>>21)+n|0)^n^i)+e[15]+530742520|0)<<16|o>>>16)+r|0)^r^n)+e[2]-995338651|0)<<23|i>>>9)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+e[0]-198630844|0)<<6|n>>>26)+i|0)|~o))+e[7]+1126891415|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+e[14]-1416354905|0)<<15|o>>>17)+r|0)|~n))+e[5]-57434055|0)<<21|i>>>11)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+e[12]+1700485571|0)<<6|n>>>26)+i|0)|~o))+e[3]-1894986606|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+e[10]-1051523|0)<<15|o>>>17)+r|0)|~n))+e[1]-2054922799|0)<<21|i>>>11)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+e[8]+1873313359|0)<<6|n>>>26)+i|0)|~o))+e[15]-30611744|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+e[6]-1560198380|0)<<15|o>>>17)+r|0)|~n))+e[13]+1309151649|0)<<21|i>>>11)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+e[4]-145523070|0)<<6|n>>>26)+i|0)|~o))+e[11]-1120210379|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+e[2]+718787259|0)<<15|o>>>17)+r|0)|~n))+e[9]-343485551|0)<<21|i>>>11)+o|0,t[0]=n+t[0]|0,t[1]=i+t[1]|0,t[2]=o+t[2]|0,t[3]=r+t[3]|0}function i(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function o(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return n}function r(t){var e,o,r,a,s,l,c=t.length,u=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)n(u,i(t.substring(e-64,e)));for(o=(t=t.substring(e-64)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<o;e+=1)r[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(n(u,r),e=0;e<16;e+=1)r[e]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,r[14]=s,r[15]=l,n(u,r),u}function a(t){var n,i="";for(n=0;n<4;n+=1)i+=e[t>>8*n+4&15]+e[t>>8*n&15];return i}function s(t){var e;for(e=0;e<t.length;e+=1)t[e]=a(t[e]);return t.join("")}function l(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function c(t){var e,n=[],i=t.length;for(e=0;e<i-1;e+=2)n.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,n)}function u(){this.reset()}return s(r("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(n,i){var o,r,a,s,l=this.byteLength,c=e(n,l),u=l;return i!==t&&(u=e(i,l)),c>u?new ArrayBuffer(0):(o=u-c,r=new ArrayBuffer(o),a=new Uint8Array(r),s=new Uint8Array(this,c,o),a.set(s),r)}}(),u.prototype.append=function(t){return this.appendBinary(l(t)),this},u.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,o=this._buff.length;for(e=64;e<=o;e+=64)n(this._hash,i(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},u.prototype.end=function(t){var e,n,i=this._buff,o=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<o;e+=1)r[e>>2]|=i.charCodeAt(e)<<(e%4<<3);return this._finish(r,o),n=s(this._hash),t&&(n=c(n)),this.reset(),n},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},u.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(t,e){var i,o,r,a=e;if(t[a>>2]|=128<<(a%4<<3),a>55)for(n(this._hash,t),a=0;a<16;a+=1)t[a]=0;i=(i=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),r=parseInt(i[1],16)||0,t[14]=o,t[15]=r,n(this._hash,t)},u.hash=function(t,e){return u.hashBinary(l(t),e)},u.hashBinary=function(t,e){var n=s(r(t));return e?c(n):n},u.ArrayBuffer=function(){this.reset()},u.ArrayBuffer.prototype.append=function(t){var e,i,r,a,s,l=(i=this._buff.buffer,r=t,a=!0,(s=new Uint8Array(i.byteLength+r.byteLength)).set(new Uint8Array(i)),s.set(new Uint8Array(r),i.byteLength),a?s:s.buffer),c=l.length;for(this._length+=t.byteLength,e=64;e<=c;e+=64)n(this._hash,o(l.subarray(e-64,e)));return this._buff=e-64<c?new Uint8Array(l.buffer.slice(e-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(t){var e,n,i=this._buff,o=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<o;e+=1)r[e>>2]|=i[e]<<(e%4<<3);return this._finish(r,o),n=s(this._hash),t&&(n=c(n)),this.reset(),n},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var t,e=u.prototype.getState.call(this);return e.buff=(t=e.buff,String.fromCharCode.apply(null,new Uint8Array(t))),e},u.ArrayBuffer.prototype.setState=function(t){return t.buff=function(t,e){var n,i=t.length,o=new ArrayBuffer(i),r=new Uint8Array(o);for(n=0;n<i;n+=1)r[n]=t.charCodeAt(n);return e?r:o}(t.buff,!0),u.prototype.setState.call(this,t)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(t,e){var i=s(function(t){var e,i,r,a,s,l,c=t.length,u=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)n(u,o(t.subarray(e-64,e)));for(t=e-64<c?t.subarray(e-64):new Uint8Array(0),i=t.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<i;e+=1)r[e>>2]|=t[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(n(u,r),e=0;e<16;e+=1)r[e]=0;return a=(a=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),l=parseInt(a[1],16)||0,r[14]=s,r[15]=l,n(u,r),u}(new Uint8Array(t)));return e?c(i):i},u}()},"80d5":function(t,e,n){},"91dd":function(t,e,n){"use strict";function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,r){e=e||"&",n=n||"=";var a={};if("string"!=typeof t||0===t.length)return a;var s=/\+/g;t=t.split(e);var l=1e3;r&&"number"==typeof r.maxKeys&&(l=r.maxKeys);var c=t.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var h,p,f,d,g=t[u].replace(s,"%20"),y=g.indexOf(n);y>=0?(h=g.substr(0,y),p=g.substr(y+1)):(h=g,p=""),f=decodeURIComponent(h),d=decodeURIComponent(p),i(a,f)?o(a[f])?a[f].push(d):a[f]=[a[f],d]:a[f]=d}return a};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},"99fb":function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("c7eb"),o=n("1da1"),r=(n("b0c0"),n("f744")),a=n("4ec3"),s=n("ec26"),l=function(){var t=Object(o.a)(Object(i.a)().mark((function t(e,n,o,l,c){var u,h,p,f,d,g,y,m,v=arguments;return Object(i.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=v.length>5&&void 0!==v[5]?v[5]:"img",t.next=3,Object(a.Nh)(!0===c?{isPrivate:1}:null);case 3:if(h=t.sent,p=h.data,"img"!==u){t.next=13;break}return t.next=8,r.a(e,{quality:.92,noCompressIfLarger:!0}).catch((function(t){throw t}));case 8:d=t.sent,g=d.dist,f=g,t.next=14;break;case 13:"file"===u&&(f=e);case 14:return y=Object(s.a)(),m=y+"."+e.name.split(".").pop(),t.abrupt("return",r.b(f,m,p.data.token).subscribe((function(t){n&&n(t)}),(function(t){o&&o(t)}),(function(t){l&&l(t)})));case 17:case"end":return t.stop()}}),t)})));return function(e,n,i,o,r){return t.apply(this,arguments)}}()},a474:function(t,e,n){},a77c:function(t,e,n){"use strict";n("ac1f"),n("5319"),n("d3b7"),n("159b"),n("caad"),n("14d9");var i=n("9339"),o=n.n(i),r=(n("8096"),n("a753"),n("14e1"),n("4ec3")),a=n("99fb"),s=o.a.import("attributors/style/align");s.whitelist=["right","center","justify"],o.a.register(s,!0);var l={"ql-bold":"加粗","ql-color":"颜色","ql-font":"字体","ql-italic":"斜体","ql-link":"添加链接","ql-background":"颜色","ql-size":"字体大小","ql-strike":"删除线","ql-script":"上标/下标","ql-underline":"下划线","ql-blockquote":"引用","ql-header":"标题","ql-indent":"缩进","ql-list":"列表","ql-align":"文本对齐","ql-direction":"文本方向","ql-image":"图片","ql-clean":"清除字体样式","ql-table":"插入表格","ql-table-insert-row":"在下方插入一行","ql-table-insert-column":"在右侧插入一列","ql-table-delete-row":"删除所在行","ql-table-delete-column":"删除所在列"},c={props:["id","fromContent","disabled"],data:function(){var t=this;return{quill:null,options:{theme:"snow",modules:{toolbar:{container:[[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],["cleanFormat"],["image"],[{table:"TD"},{"table-insert-row":"TIR"},{"table-delete-row":"TDR"},{"table-insert-column":"TIC"},{"table-delete-column":"TDC"}],[{align:[]}]],handlers:{table:function(t){this.quill.getModule("table").insertTable(3,2)},"table-insert-row":function(){this.quill.getModule("table").insertRowBelow()},"table-insert-column":function(){this.quill.getModule("table").insertColumnRight()},"table-delete-row":function(){this.quill.getModule("table").deleteRow()},"table-delete-column":function(){this.quill.getModule("table").deleteColumn()},cleanFormat:function(){t.quill.root.innerHTML=t.quill.root.innerHTML.replace(/(\<)((?!(p|img))[^\>\<])*(\>)/g,"")}}},table:!0},placeholder:"如您无其他补充说明可不填"},content:"",uploadUrl:"",subscription:null,beforeArr:[],imgList:[]}},methods:{init:function(){var t=this,e=this.$el.querySelector(".editor");this.quill=new o.a(e,this.options),setTimeout((function(){t.content?t.quill.clipboard.dangerouslyPasteHTML(t.content):t.fromContent&&t.quill.clipboard.dangerouslyPasteHTML(t.fromContent);var e=t.quill.getLength();t.quill.setSelection(e+1),t.disabled&&t.quill.enable(!1)}),500),this.quill.on("text-change",(function(){t.$emit("getContent",t.quill.root.innerHTML)}))},addQuillTitle:function(){var t=document.querySelector(".ql-toolbar"),e=document.querySelector(".editorWrp3"),n=document.querySelector(".ql-container.ql-snow"),i=t.querySelectorAll("button"),o=t.querySelectorAll("select"),r=this.$el.querySelector(".ql-cleanFormat"),a=t.querySelector(".ql-image"),s=t.querySelector(".ql-table-delete-column");i.forEach((function(t){"ql-script"===t.className?"sub"===t.value?t.title="下标":t.title="上标":"ql-indent"===t.className?"+1"===t.value?t.title="向右缩进":t.title="向左缩进":t.title=l[t.classList[0]]})),o.forEach((function(t){t.parentNode.title=l[t.classList[0]]})),r.title="清除格式",r.style.width="16px",a.style.width="18px",a.style.marginRight="0",s.style.marginRight="0",this.disabled&&(t.style.backgroundColor="var(--background-color-base)",n.style.backgroundColor="var(--background-color-base)",n.style.color="var(--color-text-grey-1)",t.style.borderColor="var(--border-color-light)",e.style.borderColor="var(--border-color-light)")},getContentData:function(){return this.quill.getContents()},handleUploadUrl:function(t){var e=this,n=t.file;Object(a.a)(n,null,(function(t){e.$message.error("文件上传失败")}),(function(t){e.upImg(t,n),e.subscription=null}),!1,["image/png","image/jpeg","image/jpg"].includes(n.type)?"img":"file").then((function(t){e.subscription=t}))},beforeAvatarUpload:function(t){var e=t.size<5242880;return e||this.$message({message:"上传图片大小不能超过 5M!",type:"warning"}),this.beforeArr.push(t),e},upLoadError:function(){this.$message.error("文件上传失败")},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!1},imgClick:function(){document.querySelector("#".concat(this.id)).click()},upImg2:function(t){if(this.disableval)this.$message({message:"禁止插入图片！",type:"warning"});else{var e="https://htmlqiniu.jihex.com/"+t.key,n=this.quill.getSelection().index;this.quill.insertEmbed(n,"image",e),this.quill.setSelection(n+1)}},upImg:function(t,e){var n=this;if(this.disableval)this.$message({message:"禁止插入图片！",type:"warning"});else if(this.imgList.push({url:"https://htmlqiniu.jihex.com/"+t.key,uid:e.uid}),this.imgList.length===this.beforeArr.length){for(var i in this.imgList)for(var o in this.beforeArr)this.imgList[i].uid===this.beforeArr[o].uid&&(this.beforeArr[o].url=this.imgList[i].url);var r=this.quill.getSelection().index;this.beforeArr.forEach((function(t,e){n.quill.insertEmbed(r+e,"image",t.url)})),this.quill.setSelection(r+this.beforeArr.length),this.beforeArr=[],this.imgList=[]}}},mounted:function(){this.uploadUrl=r.eo,this.init(),this.quill.getModule("toolbar").addHandler("image",this.imgClick),this.$el.querySelector(".ql-table-insert-row").innerHTML='<i class="iconfont iconRichTextEditor_insertRows_ic">',this.$el.querySelector(".ql-table-insert-column").innerHTML='<i class="iconfont iconRichTextEditor_insertColumn_ic">',this.$el.querySelector(".ql-table-delete-row").innerHTML='<i class="iconfont iconRichTextEditor_deleteRows_ic">',this.$el.querySelector(".ql-table-delete-column").innerHTML='<i class="iconfont iconRichTextEditor_deleteColumn_ic">',this.$el.querySelector(".ql-cleanFormat").innerHTML='<div><i class="iconfont iconqingchugeshi"></i></div>',this.$el.querySelector(".ql-image").innerHTML='<div style="display: flex;align-items: center"><i class="iconfont iconRichTextEditor_picture_ic"></i></div>';for(var t=document.querySelectorAll(".ql-toolbar.ql-snow .ql-formats"),e=0;e<t.length;e++)if([0,2,4,5].includes(e)){var n=window.document.createElement("div");n.style.width="1px",n.style.height="12px",n.style.backgroundColor="rgba(213,219,227,0.8)",n.style.marginRight="16px",n.style.marginLeft="16px",t[e].appendChild(n)}t[6].children[0].style.width="18px",this.addQuillTitle()},beforeDestroy:function(){this.subscription&&this.subscription.unsubscribe()},watch:{fromContent:function(t){this.content=t}}},u=(n("23c1"),n("2811"),n("2877")),h=Object(u.a)(c,(function(){var t=this._self._c;return t("div",{staticClass:"editorWrp3"},[t("div",{staticClass:"editor"}),t("el-upload",{staticClass:"elUpload",attrs:{"list-type":"picture-card","http-request":this.handleUploadUrl,"on-preview":this.handlePictureCardPreview,"on-success":this.upImg,"before-upload":this.beforeAvatarUpload,"on-error":this.upLoadError,multiple:"",action:this.uploadUrl}},[t("input",{attrs:{id:this.id}})])],1)}),[],!1,null,"61c561c2",null);e.a=h.exports},b383:function(t,e,n){"use strict";e.decode=e.parse=n("91dd"),e.encode=e.stringify=n("e099")},c2ba:function(t,e,n){"use strict";n("68636")},e099:function(t,e,n){"use strict";var i=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,s){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?r(a(t),(function(a){var s=encodeURIComponent(i(a))+n;return o(t[a])?r(t[a],(function(t){return s+encodeURIComponent(i(t))})).join(e):s+encodeURIComponent(i(t[a]))})).join(e):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function r(t,e){if(t.map)return t.map(e);for(var n=[],i=0;i<t.length;i++)n.push(e(t[i],i));return n}var a=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},e0cb:function(t,e,n){"use strict";n("80d5")},f744:function(t,e,n){"use strict";n.d(e,"b",(function(){return St})),n.d(e,"a",(function(){return zt}));var i,o,r=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});!function(t){t.InvalidFile="InvalidFile",t.InvalidToken="InvalidToken",t.InvalidMetadata="InvalidMetadata",t.InvalidChunkSize="InvalidChunkSize",t.InvalidCustomVars="InvalidCustomVars",t.NotAvailableUploadHost="NotAvailableUploadHost",t.ReadCacheFailed="ReadCacheFailed",t.InvalidCacheData="InvalidCacheData",t.WriteCacheFailed="WriteCacheFailed",t.RemoveCacheFailed="RemoveCacheFailed",t.GetCanvasContextFailed="GetCanvasContextFailed",t.UnsupportedFileType="UnsupportedFileType",t.FileReaderReadFailed="FileReaderReadFailed",t.NotAvailableXMLHttpRequest="NotAvailableXMLHttpRequest",t.InvalidProgressEventTarget="InvalidProgressEventTarget",t.RequestError="RequestError"}(o||(o={}));var a=function(t,e){this.name=t,this.message=e,this.stack=(new Error).stack},s=function(t){function e(e,n,i,r){var a=t.call(this,o.RequestError,i)||this;return a.code=e,a.reqId=n,a.isRequestError=!0,a.data=r,a}return r(e,t),e}(a),l=function(t){function e(e,n){return void 0===n&&(n=""),t.call(this,0,n,e)||this}return r(e,t),e}(s),c=function(){function t(t,e){this.runTask=t,this.limit=e,this.aborted=!1,this.queue=[],this.processing=[]}return t.prototype.enqueue=function(t){var e=this;return new Promise((function(n,i){e.queue.push({task:t,resolve:n,reject:i}),e.check()}))},t.prototype.run=function(t){var e=this;this.queue=this.queue.filter((function(e){return e!==t})),this.processing.push(t),this.runTask(t.task).then((function(){e.processing=e.processing.filter((function(e){return e!==t})),t.resolve(),e.check()}),(function(e){return t.reject(e)}))},t.prototype.check=function(){var t=this;if(!this.aborted){var e=this.processing.length,n=this.limit-e;this.queue.slice(0,n).forEach((function(e){t.run(e)}))}},t.prototype.abort=function(){this.queue=[],this.aborted=!0},t}(),u=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),h=function(){return(h=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},p=function(t){function e(e,n,i){var o=t.call(this)||this;return o.isStopped=!1,o.destination=e&&"object"==typeof e?e:h(h(h({},e&&{next:e}),n&&{error:n}),i&&{complete:i}),o}return u(e,t),e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype.next=function(t){!this.isStopped&&this.destination.next&&this.destination.next(t)},e.prototype.error=function(t){!this.isStopped&&this.destination.error&&(this.isStopped=!0,this.destination.error(t))},e.prototype.complete=function(t){!this.isStopped&&this.destination.complete&&(this.isStopped=!0,this.destination.complete(t))},e}(function(){function t(){this.closed=!1}return t.prototype.unsubscribe=function(){this.closed||(this.closed=!0,this._unsubscribe&&this._unsubscribe())},t.prototype.add=function(t){this._unsubscribe=t},t}()),f=function(){function t(t){this._subscribe=t}return t.prototype.subscribe=function(t,e,n){var i=new p(t,e,n);return i.add(this._subscribe(i)),i},t}();function d(t){var e,n,i,o,r,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,l=0,c="",u=[];if(!t)return t;t=function(t){if(null==t)return"";var e,n,i,o=t+"",r="";e=n=0,i=o.length;for(var a=0;a<i;a++){var s=o.charCodeAt(a),l=null;if(s<128)n++;else if(s>127&&s<2048)l=String.fromCharCode(s>>6|192,63&s|128);else if((63488&s^55296)>0)l=String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128);else{if((64512&s^55296)>0)throw new RangeError("Unmatched trail surrogate at "+a);var c=o.charCodeAt(++a);if((64512&c^56320)>0)throw new RangeError("Unmatched lead surrogate at "+(a-1));s=((1023&s)<<10)+(1023&c)+65536,l=String.fromCharCode(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}null!==l&&(n>e&&(r+=o.slice(e,n)),r+=l,e=n=a+1)}return n>e&&(r+=o.slice(e,i)),r}(t+"");do{e=(r=t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<8|t.charCodeAt(s++))>>18&63,n=r>>12&63,i=r>>6&63,o=63&r,u[l++]=a.charAt(e)+a.charAt(n)+a.charAt(i)+a.charAt(o)}while(s<t.length);switch(c=u.join(""),t.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}function g(t){var e,n,i,o,r,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,c=0,u=[];if(!t)return t;t+="";do{e=(a=s.indexOf(t.charAt(l++))<<18|s.indexOf(t.charAt(l++))<<12|(o=s.indexOf(t.charAt(l++)))<<6|(r=s.indexOf(t.charAt(l++))))>>16&255,n=a>>8&255,i=255&a,u[c++]=64===o?String.fromCharCode(e):64===r?String.fromCharCode(e,n):String.fromCharCode(e,n,i)}while(l<t.length);return function(t){var e=[],n=0,i=0,o=0;for(t+="";n<t.length;){o=0,(i=255&t.charCodeAt(n))<=191?(i&=127,o=1):i<=223?(i&=31,o=2):i<=239?(i&=15,o=3):(i&=7,o=4);for(var r=1;r<o;++r)i=i<<6|63&t.charCodeAt(r+n);4===o?(i-=65536,e.push(String.fromCharCode(55296|i>>10&1023)),e.push(String.fromCharCode(56320|1023&i))):e.push(String.fromCharCode(i)),n+=o}return e.join("")}(u.join(""))}function y(t){return(t=d(t)).replace(/\//g,"_").replace(/\+/g,"-")}var m,v=n("69a0"),b=n.n(v),k=function(){return(k=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},w=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},C=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},x=Math.pow(1024,2);function S(t,e){try{localStorage.removeItem(t)}catch(n){e.warn(new a(o.RemoveCacheFailed,"removeLocalFileInfo failed. key: "+t))}}function _(t){return{Authorization:"UpToken "+t}}function q(t){var e=_(t);return k({"content-type":"application/json"},e)}function I(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new window.ActiveXObject("Microsoft.XMLHTTP");throw new a(o.NotAvailableXMLHttpRequest,"the current environment does not support.")}function A(t){return w(this,void 0,void 0,(function(){var e,n;return C(this,(function(i){switch(i.label){case 0:return[4,P(t)];case 1:return e=i.sent(),(n=new b.a.ArrayBuffer).append(e),[2,n.end()]}}))}))}function P(t){return new Promise((function(e,n){var i=new FileReader;i.onload=function(t){if(t.target){var i=t.target.result;e(i)}else n(new a(o.InvalidProgressEventTarget,"progress event target is undefined"))},i.onerror=function(){n(new a(o.FileReaderReadFailed,"fileReader read failed"))},i.readAsArrayBuffer(t)}))}function T(t,e){return new Promise((function(n,i){var o=I();if(o.open(e.method,t),e.onCreate&&e.onCreate(o),e.headers){var r=e.headers;Object.keys(r).forEach((function(t){o.setRequestHeader(t,r[t])}))}o.upload.addEventListener("progress",(function(t){t.lengthComputable&&e.onProgress&&e.onProgress({loaded:t.loaded,total:t.total})})),o.onreadystatechange=function(){var t=o.responseText;if(4===o.readyState){var e=o.getResponseHeader("x-reqId")||"";if(0!==o.status)if(200===o.status)try{n({data:JSON.parse(t),reqId:e})}catch(t){i(t)}else{var r="xhr request failed, code: "+o.status;t&&(r+=" response: "+t);var a=void 0;try{a=JSON.parse(t)}catch(t){}i(new s(o.status,e,r,a))}else i(new l("network error.",e))}},o.send(e.body)}))}function M(t){if(t&&t.match){var e=t.match(/(^https?)/);if(!e)return"";var n=e[1];return(e=t.match(/^https?:\/\/([^:^/]*):(\d*)/))?e[2]:"http"===n?"80":"443"}return""}function O(t){if(t&&t.match){var e=t.match(/^https?:\/\/([^:^/]*)/);return e?e[1]:""}return""}function D(t){if(!t)throw new a(o.InvalidToken,"invalid token.");var e=t.split(":");if(1===e.length)throw new a(o.InvalidToken,"invalid token segments.");var n=e.length>3?e[1]:e[0];if(!n)throw new a(o.InvalidToken,"missing assess key field.");var i=null;try{i=JSON.parse(g(e[e.length-1].replace(/_/g,"/").replace(/-/g,"+")))}catch(t){throw new a(o.InvalidToken,"token parse failed.")}if(null==i)throw new a(o.InvalidToken,"putPolicy is null.");if(null==i.scope)throw new a(o.InvalidToken,"scope field is null.");var r=i.scope.split(":")[0];if(!r)throw new a(o.InvalidToken,"resolve bucketName failed.");return{assessKey:n,bucketName:r,scope:i.scope}}var U="z1",R="z2",L="na0",E="as0",z="cn-east-2",B=((m={})["z0"]={srcUphost:["up.qiniup.com"],cdnUphost:["upload.qiniup.com"]},m[U]={srcUphost:["up-z1.qiniup.com"],cdnUphost:["upload-z1.qiniup.com"]},m[R]={srcUphost:["up-z2.qiniup.com"],cdnUphost:["upload-z2.qiniup.com"]},m[L]={srcUphost:["up-na0.qiniup.com"],cdnUphost:["upload-na0.qiniup.com"]},m[E]={srcUphost:["up-as0.qiniup.com"],cdnUphost:["upload-as0.qiniup.com"]},m[z]={srcUphost:["up-cn-east-2.qiniup.com"],cdnUphost:["upload-cn-east-2.qiniup.com"]},m),F=n("b383"),j=function(){return(j=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},N=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},H=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};function V(t,e,n){return N(this,void 0,void 0,(function(){var i;return H(this,(function(o){return i=Object(F.stringify)({ak:t,bucket:e}),[2,T(n+"://api.qiniu.com/v2/query?"+i,{method:"GET"})]}))}))}function $(t,e,n){var i=n.url,o=n.id;return i+"/buckets/"+t+"/objects/"+(null!=e?y(e):"~")+"/uploads/"+o}function G(t,e,n,i,o){var r=$(D(t).bucketName,e,i)+"/"+n,a=function(t){var e=_(t);return k({"content-type":"application/octet-stream"},e)}(t);return o.md5&&(a["Content-MD5"]=o.md5),T(r,j(j({},o),{method:"PUT",headers:a}))}function W(t,e,n){return T(t,j({method:"POST",body:e},n))}var X=function(){return(X=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},J=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},K=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},Q=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},Y=[0,502,503,504,599],Z=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Q(arguments[e]));return t}(Y,[612]),tt=Math.pow(1024,3),et=function(){function t(t,e,n,i){this.hostPool=n,this.logger=i,this.aborted=!1,this.retryCount=0,this.xhrList=[],this.config=t.config,i.info("config inited.",this.config),this.putExtra=X({fname:""},t.putExtra),i.info("putExtra inited.",this.putExtra),this.key=t.key,this.file=t.file,this.token=t.token,this.onData=e.onData,this.onError=e.onError,this.onComplete=e.onComplete;try{var o=D(this.token);this.bucketName=o.bucketName,this.assessKey=o.assessKey}catch(t){i.error("get putPolicy from token failed.",t),this.onError(t)}}return t.prototype.checkAndUpdateUploadHost=function(){return J(this,void 0,void 0,(function(){var t;return K(this,(function(e){switch(e.label){case 0:return this.logger.info("get available upload host."),[4,this.hostPool.getUp(this.assessKey,this.bucketName,this.config.upprotocol)];case 1:if(null==(t=e.sent()))throw new a(o.NotAvailableUploadHost,"no available upload host.");return null!=this.uploadHost&&this.uploadHost.host!==t.host?this.logger.warn("host switches from "+this.uploadHost.host+" to "+t.host+"."):this.logger.info("use host "+t.host+"."),this.uploadHost=t,[2]}}))}))},t.prototype.checkAndUnfreezeHost=function(){this.logger.info("check unfreeze host."),null!=this.uploadHost&&this.uploadHost.isFrozen()&&(this.logger.warn(this.uploadHost.host+" will be unfrozen."),this.uploadHost.unfreeze())},t.prototype.checkAndFreezeHost=function(t){this.logger.info("check freeze host."),t instanceof s&&null!=this.uploadHost&&Y.includes(t.code)&&(this.logger.warn(this.uploadHost.host+" will be temporarily frozen."),this.uploadHost.freeze())},t.prototype.handleError=function(t){this.logger.error(t.message),this.onError(t)},t.prototype.putFile=function(){return J(this,void 0,void 0,(function(){var t,e,n;return K(this,(function(i){switch(i.label){case 0:if(this.aborted=!1,this.putExtra.fname||(this.logger.info("use file.name as fname."),this.putExtra.fname=this.file.name),this.file.size>1e4*tt)return this.handleError(new a(o.InvalidFile,"file size exceed maximum value 10000G")),[2];if(this.putExtra.customVars&&(r=this.putExtra.customVars,!Object.keys(r).every((function(t){return 0===t.indexOf("x:")}))))return this.handleError(new a(o.InvalidCustomVars,"customVars key should start width x:")),[2];if(this.putExtra.metadata&&!function(t){return Object.keys(t).every((function(t){return 0===t.indexOf("x-qn-meta-")}))}(this.putExtra.metadata))return this.handleError(new a(o.InvalidMetadata,"metadata key should start with x-qn-meta-")),[2];i.label=1;case 1:return i.trys.push([1,4,,5]),this.uploadAt=(new Date).getTime(),[4,this.checkAndUpdateUploadHost()];case 2:return i.sent(),[4,this.run()];case 3:return t=i.sent(),this.onComplete(t.data),this.checkAndUnfreezeHost(),this.sendLog(t.reqId,200),[2];case 4:return e=i.sent(),this.aborted?(this.logger.warn("upload is aborted."),this.sendLog("",-2),[2]):(this.clear(),this.logger.error(e),e instanceof s&&(this.sendLog(e.reqId,e.code),this.checkAndFreezeHost(e),n=++this.retryCount<=this.config.retryCount,Z.includes(e.code)&&n)?(this.logger.warn("error auto retry: "+this.retryCount+"/"+this.config.retryCount+"."),this.putFile(),[2]):(this.onError(e),[3,5]));case 5:return[2]}var r}))}))},t.prototype.clear=function(){this.xhrList.forEach((function(t){t.onreadystatechange=null,t.abort()})),this.xhrList=[],this.logger.info("cleanup uploading xhr.")},t.prototype.stop=function(){this.logger.info("aborted."),this.clear(),this.aborted=!0},t.prototype.addXhr=function(t){this.xhrList.push(t)},t.prototype.sendLog=function(t,e){var n,i;this.logger.report({code:e,reqId:t,remoteIp:"",upType:"jssdk-h5",size:this.file.size,time:Math.floor(this.uploadAt/1e3),port:M(null===(n=this.uploadHost)||void 0===n?void 0:n.getUrl()),host:O(null===(i=this.uploadHost)||void 0===i?void 0:i.getUrl()),bytesSent:this.progress?this.progress.total.loaded:0,duration:Math.floor(((new Date).getTime()-this.uploadAt)/1e3)})},t.prototype.getProgressInfoItem=function(t,e,n){return X({size:e,loaded:t,percent:t/e*100},null==n?{}:{fromCache:n})},t}(),nt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),it=function(){return(it=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},ot=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},rt=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};var at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return nt(e,t),e.prototype.run=function(){return ot(this,void 0,void 0,(function(){var t,e,n,i,r,l=this;return rt(this,(function(u){switch(u.label){case 0:if(this.logger.info("start run Resume."),!this.config.chunkSize||(h=this.config.chunkSize,!/^[1-9]\d*$/.test(String(h))))throw new a(o.InvalidChunkSize,"chunkSize must be a positive integer");if(this.config.chunkSize>1024)throw new a(o.InvalidChunkSize,"chunkSize maximum value is 1024");return[4,this.initBeforeUploadChunks()];case 1:u.sent(),t=new c((function(e){return ot(l,void 0,void 0,(function(){return rt(this,(function(n){switch(n.label){case 0:if(this.aborted)throw t.abort(),new Error("pool is aborted");return[4,this.uploadChunk(e)];case 1:return n.sent(),[2]}}))}))}),this.config.concurrentRequestLimit),e=null,n=this.getLocalKey(),i=this.chunks.map((function(e,n){return t.enqueue({chunk:e,index:n})})),u.label=2;case 2:return u.trys.push([2,5,,6]),[4,Promise.all(i)];case 3:return u.sent(),[4,this.mkFileReq()];case 4:return e=u.sent(),[3,6];case 5:throw(r=u.sent())instanceof s&&(612===r.code||400===r.code)&&S(n,this.logger),r;case 6:return S(n,this.logger),[2,e]}var h}))}))},e.prototype.uploadChunk=function(t){return ot(this,void 0,void 0,(function(){var e,n,i,o,r,a,s,l,c,u=this;return rt(this,(function(h){switch(h.label){case 0:return e=t.index,n=t.chunk,i=this.cachedUploadedList[e],this.logger.info("upload part "+e+", cache:",i),o=this.config.checkByMD5,r=function(){u.usedCacheList[e]=!0,u.updateChunkProgress(n.size,e),u.uploadedList[e]=i,u.updateLocalCache()},i&&!o?(r(),[2]):[4,A(n)];case 1:return a=h.sent(),this.logger.info("computed part md5.",a),i&&a===i.md5?(r(),[2]):(this.usedCacheList[e]=!1,s=function(t){u.updateChunkProgress(t.loaded,e)},l={body:n,md5:this.config.checkByServer?a:void 0,onProgress:s,onCreate:function(t){return u.addXhr(t)}},this.logger.info("part "+e+" start uploading."),[4,G(this.token,this.key,t.index+1,this.getUploadInfo(),l)]);case 2:return c=h.sent(),this.logger.info("part "+e+" upload completed."),s({loaded:n.size,total:n.size}),this.uploadedList[e]={etag:c.data.etag,md5:c.data.md5,size:n.size},this.updateLocalCache(),[2]}}))}))},e.prototype.mkFileReq=function(){return ot(this,void 0,void 0,(function(){var t,e,n=this;return rt(this,(function(i){switch(i.label){case 0:return t=it(it(it({parts:this.uploadedList.map((function(t,e){return{etag:t.etag,partNumber:e+1}})),fname:this.putExtra.fname},this.putExtra.mimeType&&{mimeType:this.putExtra.mimeType}),this.putExtra.customVars&&{customVars:this.putExtra.customVars}),this.putExtra.metadata&&{metadata:this.putExtra.metadata}),this.logger.info("parts upload completed, make file.",t),[4,(o=this.token,r=this.key,a=this.getUploadInfo(),s={onCreate:function(t){return n.addXhr(t)},body:JSON.stringify(t)},T($(D(o).bucketName,r,a),j(j({},s),{method:"POST",headers:q(o)})))];case 1:return e=i.sent(),this.logger.info("finish Resume Progress."),this.updateMkFileProgress(1),[2,e]}var o,r,a,s}))}))},e.prototype.initBeforeUploadChunks=function(){return ot(this,void 0,void 0,(function(){var t,e,n;return rt(this,(function(i){switch(i.label){case 0:return this.uploadedList=[],this.usedCacheList=[],(t=function(t,e){var n=null;try{n=localStorage.getItem(t)}catch(n){e.warn(new a(o.ReadCacheFailed,"getLocalFileInfo failed. key: "+t))}if(null==n)return null;var i=null;try{i=JSON.parse(n)}catch(n){S(t,e),e.warn(new a(o.InvalidCacheData,"getLocalFileInfo failed to parse. key: "+t))}return i}(this.getLocalKey(),this.logger))?[3,2]:(this.logger.info("init upload parts from api."),[4,(r=this.token,s=this.bucketName,l=this.key,c=this.uploadHost.getUrl(),T(c+"/buckets/"+s+"/objects/"+(null!=l?y(l):"~")+"/uploads",{method:"POST",headers:_(r)}))]);case 1:return e=i.sent(),this.logger.info("initd upload parts of id: "+e.data.uploadId+"."),this.uploadId=e.data.uploadId,this.cachedUploadedList=[],[3,3];case 2:n=["resume upload parts from local cache,","total "+t.data.length+" part,","id is "+t.id+"."],this.logger.info(n.join(" ")),this.cachedUploadedList=t.data,this.uploadId=t.id,i.label=3;case 3:return this.chunks=function(t,e){var n=e*x;if(n>t.size)n=t.size;else for(;t.size>1e4*n;)n*=2;for(var i=[],o=Math.ceil(t.size/n),r=0;r<o;r++){var a=t.slice(n*r,r===o-1?t.size:n*(r+1));i.push(a)}return i}(this.file,this.config.chunkSize),this.loaded={mkFileProgress:0,chunks:this.chunks.map((function(t){return 0}))},this.notifyResumeProgress(),[2]}var r,s,l,c}))}))},e.prototype.getUploadInfo=function(){return{id:this.uploadId,url:this.uploadHost.getUrl()}},e.prototype.getLocalKey=function(){return t=this.file.name,e=this.key,n=this.file.size,"qiniu_js_sdk_upload_file_name_"+t+(null==e?"_":"_key_"+e+"_")+"size_"+n;var t,e,n},e.prototype.updateLocalCache=function(){!function(t,e,n){try{localStorage.setItem(t,JSON.stringify(e))}catch(e){n.warn(new a(o.WriteCacheFailed,"setLocalFileInfo failed: "+t))}}(this.getLocalKey(),{id:this.uploadId,data:this.uploadedList},this.logger)},e.prototype.updateChunkProgress=function(t,e){this.loaded.chunks[e]=t,this.notifyResumeProgress()},e.prototype.updateMkFileProgress=function(t){this.loaded.mkFileProgress=t,this.notifyResumeProgress()},e.prototype.notifyResumeProgress=function(){var t,e=this;this.progress={total:this.getProgressInfoItem((t=this.loaded.chunks,t.reduce((function(t,e){return t+e}),0)+this.loaded.mkFileProgress),this.file.size+1),chunks:this.chunks.map((function(t,n){var i=e.usedCacheList[n];return e.getProgressInfoItem(e.loaded.chunks[n],t.size,i)})),uploadInfo:{id:this.uploadId,url:this.uploadHost.getUrl()}},this.onData(this.progress)},e}(et),st=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},lt=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},ct=function(){function t(){this.crc=-1,this.table=this.makeTable()}return t.prototype.makeTable=function(){for(var t=new Array,e=0;e<256;e++){for(var n=e,i=0;i<8;i++)1&n?n=n>>>1^3988292384:n>>>=1;t[e]=n}return t},t.prototype.append=function(t){for(var e=this.crc,n=0;n<t.byteLength;n++)e=e>>>8^this.table[255&(e^t[n])];this.crc=e},t.prototype.compute=function(){return(-1^this.crc)>>>0},t.prototype.readAsUint8Array=function(t){return st(this,void 0,void 0,(function(){var e;return lt(this,(function(n){switch(n.label){case 0:return"function"!=typeof t.arrayBuffer?[3,2]:(e=Uint8Array.bind,[4,t.arrayBuffer()]);case 1:return[2,new(e.apply(Uint8Array,[void 0,n.sent()]))];case 2:return[2,new Promise((function(e,n){var i=new FileReader;i.onload=function(){null!=i.result&&"string"!=typeof i.result?e(new Uint8Array(i.result)):n()},i.readAsArrayBuffer(t)}))]}}))}))},t.prototype.file=function(t){return st(this,void 0,void 0,(function(){var e,n,i,o,r,a;return lt(this,(function(s){switch(s.label){case 0:return t.size<=x?(e=this.append,[4,this.readAsUint8Array(t)]):[3,2];case 1:return e.apply(this,[s.sent()]),[2,this.compute()];case 2:n=Math.ceil(t.size/x),i=0,s.label=3;case 3:return i<n?(o=i*x,r=i===n-1?t.size:o+x,[4,this.readAsUint8Array(t.slice(o,r))]):[3,6];case 4:a=s.sent(),this.append(new Uint8Array(a)),s.label=5;case 5:return i++,[3,3];case 6:return[2,this.compute()]}}))}))},t.file=function(e){return(new t).file(e)},t}(),ut=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ht=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},pt=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ut(e,t),e.prototype.run=function(){return ht(this,void 0,void 0,(function(){var t,e,n,i,o=this;return pt(this,(function(r){switch(r.label){case 0:return this.logger.info("start run Direct."),(t=new FormData).append("file",this.file),t.append("token",this.token),null!=this.key&&t.append("key",this.key),t.append("fname",this.putExtra.fname),this.config.checkByServer?[4,ct.file(this.file)]:[3,2];case 1:e=r.sent(),t.append("crc32",e.toString()),r.label=2;case 2:return this.putExtra.customVars&&(this.logger.info("init customVars."),n=this.putExtra.customVars,Object.keys(n).forEach((function(e){return t.append(e,n[e].toString())})),this.logger.info("customVars inited.")),this.logger.info("formData inited."),[4,W(this.uploadHost.getUrl(),t,{onProgress:function(t){o.updateDirectProgress(t.loaded,t.total)},onCreate:function(t){return o.addXhr(t)}})];case 3:return i=r.sent(),this.logger.info("Direct progress finish."),this.finishDirectProgress(),[2,i]}}))}))},e.prototype.updateDirectProgress=function(t,e){this.progress={total:this.getProgressInfoItem(t,e+1)},this.onData(this.progress)},e.prototype.finishDirectProgress=function(){if(!this.progress)return this.logger.warn("progress is null."),this.progress={total:this.getProgressInfoItem(this.file.size,this.file.size)},void this.onData(this.progress);var t=this.progress.total;this.progress={total:this.getProgressInfoItem(t.loaded+1,t.size)},this.onData(this.progress)},e}(et);var dt=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},gt=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(dt(arguments[e]));return t},yt=function(){function t(e,n,i,o){void 0===n&&(n=!0),void 0===i&&(i="OFF"),void 0===o&&(o="UPLOAD"),this.token=e,this.disableReport=n,this.level=i,this.prefix=o,this.id=++t.id}return t.prototype.getPrintPrefix=function(t){return"Qiniu-JS-SDK ["+t+"]["+this.prefix+"#"+this.id+"]:"},t.prototype.report=function(t,e){if(!this.disableReport)try{!function t(e,n,i){void 0===i&&(i=3);var o=I();o.open("POST","https://uplog.qbox.me/log/3"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("Authorization",_(e).Authorization),o.onreadystatechange=function(){4===o.readyState&&200!==o.status&&i>0&&t(e,n,i-1)};var r=[n.code||"",n.reqId||"",n.host||"",n.remoteIp||"",n.port||"",n.duration||"",n.time||"",n.bytesSent||"",n.upType||"",n.size||""].join(",");o.send(r)}(this.token,t,e)}catch(t){this.warn(t)}},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=["INFO"];n.includes(this.level)&&console.log.apply(console,gt([this.getPrintPrefix("INFO")],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=["INFO","WARN"];n.includes(this.level)&&console.warn.apply(console,gt([this.getPrintPrefix("WARN")],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=["INFO","WARN","ERROR"];n.includes(this.level)&&console.error.apply(console,gt([this.getPrintPrefix("ERROR")],t))},t.id=0,t}(),mt=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},vt=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},bt=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},kt=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(bt(arguments[e]));return t},wt=new Map,Ct=function(){function t(t,e){this.host=t,this.protocol=e}return t.prototype.isFrozen=function(){var t=(new Date).getTime(),e=wt.get(this.host);return null!=e&&e>=t},t.prototype.freeze=function(t){void 0===t&&(t=20);var e=(new Date).getTime()+1e3*t;wt.set(this.host,e)},t.prototype.unfreeze=function(){wt.delete(this.host)},t.prototype.getUrl=function(){return this.protocol+"://"+this.host},t.prototype.getUnfreezeTime=function(){return wt.get(this.host)},t}(),xt=function(){function t(t){void 0===t&&(t=[]),this.initHosts=t,this.cachedHostsMap=new Map}return t.prototype.register=function(t,e,n,i){this.cachedHostsMap.set(t+"@"+e,n.map((function(t){return new Ct(t,i)})))},t.prototype.refresh=function(t,e,n){var i,o,r,a;return mt(this,void 0,void 0,(function(){var s,l;return vt(this,(function(c){switch(c.label){case 0:return(this.cachedHostsMap.get(t+"@"+e)||[]).length>0?[2]:this.initHosts.length>0?(this.register(t,e,this.initHosts,n),[2]):[4,V(t,e,n)];case 1:return null!=(null==(s=c.sent())?void 0:s.data)&&(l=kt((null===(o=null===(i=s.data.up)||void 0===i?void 0:i.acc)||void 0===o?void 0:o.main)||[],(null===(a=null===(r=s.data.up)||void 0===r?void 0:r.acc)||void 0===a?void 0:a.backup)||[]),this.register(t,e,l,n)),[2]}}))}))},t.prototype.getUp=function(t,e,n){return mt(this,void 0,void 0,(function(){var i,o;return vt(this,(function(r){switch(r.label){case 0:return[4,this.refresh(t,e,n)];case 1:return r.sent(),0===(i=this.cachedHostsMap.get(t+"@"+e)||[]).length?[2,null]:(o=i.filter((function(t){return!t.isFrozen()}))).length>0?[2,o[0]]:[2,i.slice().sort((function(t,e){return(t.getUnfreezeTime()||0)-(e.getUnfreezeTime()||0)}))[0]]}}))}))},t}();function St(t,e,n,i,o){var r=new yt(n,null==o?void 0:o.disableStatisticsReport,null==o?void 0:o.debugLogLevel,t.name),a={file:t,key:e,token:n,putExtra:i,config:Pt(o,r)},s=new xt(a.config.uphost);return new f((function(t){var e=function(t,e,n,i){return t.config&&t.config.forceDirect?(i.info("ues forceDirect mode."),new ft(t,e,n,i)):t.file.size>4*x?(i.info("file size over 4M, use Resume."),new at(t,e,n,i)):(i.info("file size less or equal than 4M, use Direct."),new ft(t,e,n,i))}(a,{onData:function(e){return t.next(e)},onError:function(e){return t.error(e)},onComplete:function(e){return t.complete(e)}},s,r);return e.putFile(),e.stop.bind(e)}))}var _t=function(){return(_t=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},qt=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]])}return n},It=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},At=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(It(arguments[e]));return t};function Pt(t,e){var n=_t({},t),i=n.upprotocol,o=n.uphost,r=qt(n,["upprotocol","uphost"]),a=_t({uphost:[],retryCount:3,checkByMD5:!1,forceDirect:!1,useCdnDomain:!0,checkByServer:!1,concurrentRequestLimit:3,chunkSize:4,upprotocol:"https",debugLogLevel:"OFF",disableStatisticsReport:!1},r);i&&(a.upprotocol=i.replace(/:$/,""));var s=[];if(e&&null!=(null==t?void 0:t.uphost)&&null!=(null==t?void 0:t.region)&&e.warn("do not use both the uphost and region config."),o)Array.isArray(o)?s.push.apply(s,At(o)):s.push(o);else if(null==a?void 0:a.region){var l=B[null==a?void 0:a.region];a.useCdnDomain?s.push.apply(s,At(l.cdnUphost)):s.push.apply(s,At(l.srcUphost))}return _t(_t({},a),{uphost:s.filter(Boolean)})}var Tt=function(){return(Tt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Mt=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((i=i.apply(t,e||[])).next())}))},Ot=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},Dt={PNG:"image/png",JPEG:"image/jpeg",WEBP:"image/webp",BMP:"image/bmp"},Ut=Math.log(2),Rt=Object.keys(Dt).map((function(t){return Dt[t]})),Lt=Dt.JPEG;var Et=function(){function t(t,e){this.file=t,this.config=e,this.config=Tt({quality:.92,noCompressIfLarger:!1},this.config)}return t.prototype.process=function(){return Mt(this,void 0,void 0,(function(){var t,e,n,i,r,s;return Ot(this,(function(l){switch(l.label){case 0:if(this.outputType=this.file.type,t={},c=this.file.type,!Rt.includes(c))throw new a(o.UnsupportedFileType,"unsupported file type: "+this.file.type);return[4,this.getOriginImage()];case 1:return e=l.sent(),[4,this.getCanvas(e)];case 2:return n=l.sent(),i=1,this.config.maxWidth&&(i=Math.min(1,this.config.maxWidth/n.width)),this.config.maxHeight&&(i=Math.min(1,i,this.config.maxHeight/n.height)),t.width=n.width,t.height=n.height,[4,this.doScale(n,i)];case 3:return r=l.sent(),(s=this.toBlob(r)).size>this.file.size&&this.config.noCompressIfLarger?[2,{dist:this.file,width:t.width,height:t.height}]:[2,{dist:s,width:r.width,height:r.height}]}var c}))}))},t.prototype.clear=function(t,e,n){this.outputType===Lt?(t.fillStyle="#fff",t.fillRect(0,0,e,n)):t.clearRect(0,0,e,n)},t.prototype.getOriginImage=function(){var t=this;return new Promise((function(e,n){var i,o=(i=t.file,(window.URL||window.webkitURL||window.mozURL).createObjectURL(i)),r=new Image;r.onload=function(){e(r)},r.onerror=function(){n("image load error")},r.src=o}))},t.prototype.getCanvas=function(t){var e=this;return new Promise((function(n,i){var r=document.createElement("canvas"),s=r.getContext("2d");if(s){var l=t.width,c=t.height;r.height=c,r.width=l,e.clear(s,l,c),s.drawImage(t,0,0),n(r)}else i(new a(o.GetCanvasContextFailed,"context is null"))}))},t.prototype.doScale=function(t,e){return Mt(this,void 0,void 0,(function(){var n,i,r,s,l,c,u,h,p,f,d,g,y,m,v,b;return Ot(this,(function(k){if(1===e)return[2,t];if(n=t.getContext("2d"),i=Math.min(4,Math.ceil(1/e/Ut)),r=Math.pow(e,1/i),s=document.createElement("canvas"),l=s.getContext("2d"),c=t.width,u=t.height,h=c,p=u,s.width=c,s.height=u,!l||!n)throw new a(o.GetCanvasContextFailed,"mctx or sctx can't be null");for(g=0;g<i;g++)y=c*r|0,m=u*r|0,g===i-1&&(y=h*e,m=p*e),g%2==0?(f=t,d=l):(f=s,d=n),this.clear(d,c,u),d.drawImage(f,0,0,c,u,0,0,y,m),c=y,u=m;return v=f===t?s:t,b=d.getImageData(0,0,c,u),v.width=c,v.height=u,d.putImageData(b,0,0),[2,v]}))}))},t.prototype.toBlob=function(t){var e=t.toDataURL(this.outputType,this.config.quality),n=atob(e.split(",")[1]).split("").map((function(t){return t.charCodeAt(0)}));return new Blob([new Uint8Array(n)],{type:this.outputType})},t}(),zt=function(t,e){return new Et(t,e).process()}}}]);